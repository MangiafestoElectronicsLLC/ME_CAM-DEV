ME CAMERA SYSTEM v2.1 - COMPREHENSIVE SETUP & REFERENCE GUIDE
================================================================

DOCUMENT OVERVIEW
=================
This guide covers complete setup from fresh SD card to production-ready ME Camera 
system on Raspberry Pi (Zero 2W, 3B+, 4, or 5).

Quick Facts:
- Framework: Python 3.9+ with Flask 2.2.5
- OS: Raspberry Pi OS Bullseye (32-bit recommended)
- Target Audience: Developers and system administrators
- Status: Production-Ready (v2.1)
- GitHub: https://github.com/MangiafestoElectronicsLLC/ME_CAM-DEV
- Last Updated: January 15, 2026

SYSTEM REQUIREMENTS
===================
Hardware:
  â€¢ Raspberry Pi: Zero 2W (minimum), 3B+, 4, or 5 (recommended)
  â€¢ microSD Card: 32GB+ for full recording capability
  â€¢ Power Supply: USB-C 5V 2.5A (critical for Pi Zero 2W stability)
  â€¢ Network: WiFi or Ethernet connectivity
  â€¢ Optional: USB Battery pack, additional Pi for multi-device setup

Software Prerequisites:
  â€¢ Raspberry Pi Imager (for OS flashing)
  â€¢ SSH client (for remote access)
  â€¢ Git (for repository cloning)
  â€¢ Python 3.9+ (automatic in Bullseye)

PART 1: FRESH SD CARD INSTALLATION
===================================

STEP 1: OBTAIN & VERIFY SD CARD
---------------------------------
1. Obtain 32GB+ microSD card (UHS-II recommended for performance)
2. Test card on another device to verify it works
3. Clear any existing data if reusing card

STEP 2: DOWNLOAD RASPBERRY PI IMAGER
-------------------------------------
1. Go to https://www.raspberrypi.com/software/
2. Download Raspberry Pi Imager (choose your OS: Windows/Mac/Linux)
3. Install and launch the application

STEP 3: FLASH OS IMAGE
------------------------
âš ï¸  CRITICAL: Choose Bullseye, NOT Bookworm. Other versions incompatible.

1. Click "CHOOSE OS"
2. Navigate to: Raspberry Pi OS (Other) â†’ Raspberry Pi OS Lite (Bullseye)
3. Click "CHOOSE STORAGE" and select your microSD card
4. Click GEAR ICON (âš™ï¸) for Advanced Options:
   
   CONFIGURE THESE SETTINGS:
   â”œâ”€ Hostname: mecamera (or your preferred name)
   â”œâ”€ Enable SSH: YES (check "Use password authentication")
   â”œâ”€ Username: pi
   â”œâ”€ Password: [secure password - you'll use this frequently]
   â”œâ”€ Configure WiFi: Enter SSID and password
   â”œâ”€ WiFi country: [Your country code]
   â”œâ”€ Set locale settings: Timezone [UTC or your timezone]
   â””â”€ Disable telemetry: YES (for privacy)

5. Click "WRITE" and wait for completion (5-15 minutes)
6. When complete, safely eject the SD card from computer

STEP 4: FIRST BOOT
-------------------
1. Insert microSD card into Raspberry Pi
2. Connect power supply (USB-C for Pi Zero 2W, USB-C for others)
3. Wait 2-3 minutes for first boot to complete
4. Green LED should show activity, then stabilize

STEP 5: SSH CONNECTION & INITIAL SETUP
---------------------------------------
1. From computer, open terminal/command prompt
2. SSH into Pi:
   ssh pi@mecamera.local
   (Or use IP if hostname doesn't work: ssh pi@[IP-ADDRESS])

3. Password prompt appears - enter the password from Step 3

4. Update system (this takes 5-10 minutes):
   sudo apt update
   sudo apt upgrade -y

5. Install required packages:
   sudo apt install -y git python3-pip python3-venv

6. Verify Python version (should be 3.9+):
   python3 --version

PART 2: CRITICAL CONFIGURATION - LEGACY CAMERA DISABLING
========================================================

âš ï¸  WARNING: THIS STEP IS REQUIRED FOR ALL RASPBERRY PI MODELS
   Skipping this causes camera detection to fail on Pi 3B+/4/5

STEP 6: DISABLE LEGACY CAMERA MODE
------------------------------------
1. From SSH session, run:
   sudo raspi-config

2. Navigate to menu:
   â†’ Interfacing Options (or Interface Options)
   â†’ Camera
   â†’ Select: NO

3. After confirmation, continue in raspi-config to:
   â†’ Interfacing Options
   â†’ I2C
   â†’ Select: YES (enables battery monitoring)

4. Exit raspi-config (usually Tab to Finish or Ctrl+C)

5. When prompted "Would you like to reboot now?": Select YES

6. SSH connection will disconnect. Wait 30 seconds, then:
   ssh pi@mecamera.local
   (Log in again with same password)

7. Verify reboot completed:
   uptime
   (Should show system up for ~1 minute)

PART 3: PROJECT SETUP & DEPENDENCIES
====================================

STEP 7: CLONE REPOSITORY
------------------------
1. Change to home directory:
   cd ~

2. Clone ME Camera project:
   git clone https://github.com/MangiafestoElectronicsLLC/ME_CAM-DEV.git

3. Navigate to project:
   cd ME_CAM-DEV

4. Verify project structure:
   ls -la
   
   Should display:
   â”œâ”€ src/               (source code)
   â”œâ”€ web/               (Flask app)
   â”œâ”€ config/            (configuration)
   â”œâ”€ templates/         (HTML templates)
   â”œâ”€ main.py            (entry point)
   â”œâ”€ requirements.txt   (dependencies)
   â”œâ”€ hub.py             (multi-device hub)
   â”œâ”€ .gitignore         (git configuration)
   â””â”€ [other files...]

STEP 8: PYTHON VIRTUAL ENVIRONMENT
-----------------------------------
1. Create virtual environment:
   python3 -m venv venv

2. Activate virtual environment:
   source venv/bin/activate
   
   (You should see (venv) prefix in terminal)

3. Upgrade pip:
   pip install --upgrade pip

4. Upgrade setuptools:
   pip install --upgrade setuptools wheel

STEP 9: INSTALL DEPENDENCIES
----------------------------
1. Install from requirements.txt:
   pip install -r requirements.txt
   
   This installs:
   â€¢ Flask 2.2.5 (web framework)
   â€¢ Pillow 9.5.0 (image processing)
   â€¢ numpy 1.24.3 (numerical computing)
   â€¢ picamera2 (camera control)
   â€¢ google-auth-httplib2 (Google APIs)
   â€¢ google-api-python-client (Drive backup)
   â€¢ werkzeug (web utilities)
   â€¢ + 15 additional packages

2. Verify installation completed successfully (no errors shown)

3. Confirm core packages:
   python3 -c "import flask, picamera2, numpy; print('All packages OK')"
   
   Expected output: "All packages OK"

STEP 10: CONFIGURATION
----------------------
1. Copy default configuration:
   cp config/config_default.json config/config.json

2. Edit configuration file:
   nano config/config.json

3. Customize these key settings:
   {
     "device_name": "My Device",
     "device_id": "camera-001",
     "pi_model": "auto",
     "enable_battery": true,
     "battery_pin": 17,
     "enable_camera": true,
     "camera_fps": "auto",
     "enable_motion": true,
     "motion_threshold": 15,
     "enable_cloud": false,
     "remote_devices": []
   }

4. Save changes: Ctrl+X â†’ Y â†’ Enter

5. Verify configuration loaded:
   python3 -c "import json; print(json.load(open('config/config.json'))['device_name'])"

PART 4: SYSTEMD SERVICE SETUP
============================

STEP 11: INSTALL SERVICE FILE
------------------------------
1. Copy service file to systemd:
   sudo cp etc/systemd/system/mecamera.service /etc/systemd/system/

   If file doesn't exist, manually create:
   sudo nano /etc/systemd/system/mecamera.service
   
   Paste this content:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   [Unit]
   Description=ME Camera Security System
   After=network-online.target
   Wants=network-online.target
   
   [Service]
   Type=simple
   User=pi
   WorkingDirectory=/home/pi/ME_CAM-DEV
   Environment="PATH=/home/pi/ME_CAM-DEV/venv/bin"
   ExecStart=/home/pi/ME_CAM-DEV/venv/bin/python main.py
   Restart=always
   RestartSec=10
   StandardOutput=journal
   StandardError=journal
   
   [Install]
   WantedBy=multi-user.target
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2. Save and exit: Ctrl+X â†’ Y â†’ Enter

3. Reload systemd daemon:
   sudo systemctl daemon-reload

4. Verify service file loaded:
   sudo systemctl show mecamera
   (Should show Type=simple and other service properties)

STEP 12: ENABLE AUTO-START
---------------------------
1. Enable service for boot:
   sudo systemctl enable mecamera

2. Start service immediately:
   sudo systemctl start mecamera

3. Wait 3 seconds for startup:
   sleep 3

4. Check service status:
   sudo systemctl status mecamera
   
   Expected output:
   â— mecamera.service - ME Camera Security System
       Loaded: loaded (/etc/systemd/system/mecamera.service; enabled)
       Active: active (running)

5. View real-time logs:
   sudo journalctl -u mecamera -f
   
   Should show:
   [PI_DETECT] Detected: Raspberry Pi Zero 2W
   [BATTERY] GPIO monitoring enabled on pin 17
   [CAMERA] Camera system initialized
   [SERVER] Flask app starting on 0.0.0.0:8080

STEP 13: VERIFY WEB DASHBOARD ACCESS
--------------------------------------
1. Get Pi's IP address:
   hostname -I
   (Note the IP, usually like 192.168.x.x)

2. Open web browser and navigate to:
   http://[IP-ADDRESS]:8080
   OR
   http://mecamera.local:8080

3. Log in with default credentials:
   Username: admin
   Password: admin123

4. Verify dashboard displays:
   âœ“ "â— ONLINE" status (green indicator)
   âœ“ Device name from config.json
   âœ“ Battery percentage (0-100%)
   âœ“ Storage used and available
   âœ“ Recordings count
   âœ“ Camera stream or TEST MODE message

SUCCESS! Your ME Camera system is now running.

PART 5: UNDERSTANDING PI ZERO 2W CAMERA LIMITATIONS
===================================================

WHY CAMERA WON'T DISPLAY ON PI ZERO 2W?
========================================

The System is Working Correctly:
Pi Zero 2W has only 512MB total RAM. Memory allocation breakdown:
â€¢ Raspberry Pi OS: ~100-120MB
â€¢ Python 3.9 runtime: ~40-50MB
â€¢ Flask web framework: ~30-40MB
â€¢ System caches & buffers: ~150-180MB
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Remaining available: ~100-150MB

Camera streaming requires:
â€¢ Input buffer (capture frame): ~50MB
â€¢ Processing buffer (compression): ~100MB
â€¢ Output buffer (streaming): ~50MB
â€¢ System headroom (OS functions): ~50MB
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Total required: ~250MB MINIMUM

MATHEMATICAL FACT: 100-150MB available < 250MB required = IMPOSSIBLE

System Behavior is CORRECT:
1. System detects memory insufficient at startup
2. Automatically enters TEST MODE
3. Shows "Camera Hardware Detection Failed" message
4. Provides troubleshooting information
5. Falls back to storage/recording/motion detection

This is NOT a Bug - It's Hardware Reality.

Verification Steps:
1. Check available memory:
   free -m
   
   Example output for Pi Zero 2W:
   Mem:   430    220     50     26  148     120
   â†‘ Only 430MB total, 50MB free

2. View system startup logs:
   sudo journalctl -u mecamera -n 30
   
   Look for: "[CAMERA] Memory insufficient, TEST MODE enabled"

3. Check camera detection:
   sudo vcgencmd get_camera
   
   Output: supported=1 detected=0 (means: supported but not detected/allocated)

How to Display Camera:
â€¢ Option 1: Use Pi 3B+ or higher (recommended, ~$25)
â€¢ Option 2: Use Pi Zero 2W for recording/motion only (no display)
â€¢ Option 3: Monitor Pi Zero 2W from camera on different Pi (multi-device)

PART 6: MULTI-DEVICE SETUP
===========================

STEP 14: CONFIGURE SECONDARY CAMERA
------------------------------------
Set up additional Pi cameras on your network:

1. Repeat STEPS 1-13 on second Raspberry Pi
2. Give it unique device_id in config.json:
   "device_id": "camera-garage"  (instead of "camera-001")

3. On PRIMARY Pi, edit config.json:
   "remote_devices": [
     {
       "device_id": "camera-garage",
       "name": "Garage Camera",
       "hostname": "camera-garage.local",
       "ip_address": "192.168.1.50",
       "port": 8080,
       "enabled": true
     }
   ]

4. Restart primary Pi service:
   sudo systemctl restart mecamera

5. Access multi-device dashboard:
   Navigate to "ğŸ“¡ Devices" page
   All devices should appear with status, battery, storage

STEP 15: API ENDPOINTS FOR MULTI-DEVICE
-----------------------------------------
Test multi-device API endpoints:

List all devices:
curl http://127.0.0.1:8080/api/devices

Get primary device status:
curl http://127.0.0.1:8080/api/status

Get remote device status:
curl http://127.0.0.1:8080/api/devices/camera-garage/status

Get remote device battery:
curl http://127.0.0.1:8080/api/devices/camera-garage/battery

Get remote device storage:
curl http://127.0.0.1:8080/api/devices/camera-garage/storage

PART 7: HTTPS & DOMAIN SETUP (OPTIONAL)
======================================

STEP 16: ENABLE HTTPS
---------------------
Self-signed certificates provided in certs/ directory:

1. Verify certificates exist:
   ls -la certs/
   Should show: certificate.pem, private_key.pem

2. HTTPS automatically enabled in Flask
   Access via: https://mecamera.local:8080

3. Browser shows security warning (expected for self-signed)
   Click: "Advanced" â†’ "Proceed" or browser equivalent

STEP 17: DOMAIN NAME ACCESS
----------------------------
To access via https://me_cam.com:

Windows:
1. Open Notepad as Administrator
2. Edit: C:\Windows\System32\drivers\etc\hosts
3. Add line: [PI-IP-ADDRESS] me_cam.com
4. Save and close
5. Flush DNS: ipconfig /flushdns

Mac/Linux:
1. Open Terminal
2. Edit: sudo nano /etc/hosts
3. Add line: [PI-IP-ADDRESS] me_cam.com
4. Save: Ctrl+X â†’ Y â†’ Enter
5. Flush DNS: sudo dscacheutil -flushcache (Mac) or sudo resolvectl flush-caches (Linux)

Then access: https://me_cam.com:8080

PART 8: TROUBLESHOOTING
=======================

ISSUE: Service shows "inactive" or "failed"
--------------------------------------------
Step 1: Check service file exists
  ls -la /etc/systemd/system/mecamera.service
  (Should exist and show rw-r--r-- permissions)

Step 2: Check Python environment
  source /home/pi/ME_CAM-DEV/venv/bin/activate
  python3 -c "import flask; print('Flask OK')"
  
Step 3: Check for errors in logs
  sudo journalctl -u mecamera -n 50
  Look for "Error", "Traceback", "not found"

Step 4: Reload and restart
  sudo systemctl daemon-reload
  sudo systemctl restart mecamera
  sleep 3
  sudo systemctl status mecamera

ISSUE: Dashboard shows "OFFLINE" but Pi is responding
------------------------------------------------------
Step 1: Test API directly
  curl http://127.0.0.1:8080/api/status
  (Should return {"active": true, "timestamp": ...})

Step 2: Check port 8080 is listening
  sudo netstat -tlnp | grep 8080
  Should show: "LISTEN" status

Step 3: Check network connectivity
  hostname -I
  (Should show valid IP, not 127.0.0.1 only)

Step 4: Restart service
  sudo systemctl restart mecamera
  sleep 3
  curl http://127.0.0.1:8080/api/status

ISSUE: Battery shows 0% or incorrect percentage
-------------------------------------------------
Step 1: Verify GPIO connection
  Check physical wire connection to GPIO 17 and GND
  
Step 2: Test GPIO reading
  gpio readall | grep 17
  Should show GPIO 17 state
  
Step 3: Recalibrate battery
  Fully charge battery
  Unplug power (if using USB) to reset
  Then check percentage again
  
Step 4: Check battery enabled in config
  grep "enable_battery" config/config.json
  Should show: "enable_battery": true

ISSUE: Storage shows 0 bytes
------------------------------
Step 1: Check recordings directory exists
  ls -la ~/ME_CAM-DEV/recordings/
  Should show directory listing
  
Step 2: Check permissions
  ls -lad ~/ME_CAM-DEV/recordings/
  Should show: drwxr-xr-x (755 permissions)
  
Step 3: Check disk space
  df -h
  Should show space available on /home partition
  
Step 4: Test write permission
  touch ~/ME_CAM-DEV/recordings/test.txt
  rm ~/ME_CAM-DEV/recordings/test.txt
  (Should work without errors)

ISSUE: Web interface slow or freezing
--------------------------------------
Step 1: Check system resources
  top
  Press 'q' to exit
  Look for high CPU (>80%) or low memory (<50MB free)
  
Step 2: Check memory usage
  free -m
  Mem: [total] [used] [free]
  
Step 3: Restart service if needed
  sudo systemctl restart mecamera
  
Step 4: Check network connectivity
  ping 8.8.8.8
  (4 responses = good connection)

ISSUE: Can't access https://me_cam.com
----------------------------------------
Step 1: Verify hosts file edited (see STEP 17)
  Windows: type C:\Windows\System32\drivers\etc\hosts | findstr me_cam
  Mac/Linux: cat /etc/hosts | grep me_cam
  Should show: [IP] me_cam.com

Step 2: Flush DNS cache
  Windows: ipconfig /flushdns
  Mac: sudo dscacheutil -flushcache
  Linux: sudo resolvectl flush-caches

Step 3: Test DNS resolution
  nslookup me_cam.com (Windows)
  or
  dig me_cam.com (Mac/Linux)
  Should resolve to your Pi's IP

Step 4: Verify HTTPS certificate
  First access shows browser security warning
  Click "Advanced" â†’ "Proceed Anyway"
  Certificate is self-signed (expected)

PART 9: PRODUCTION CHECKLIST
============================

Pre-Deployment (Before Connecting to Network):
[ ] SD card flashed with Bullseye (verified)
[ ] SSH connection tested (can log in)
[ ] System updated (sudo apt upgrade complete)
[ ] Legacy camera disabled (raspi-config confirmed)
[ ] Project cloned successfully (git clone OK)
[ ] Virtual environment created (venv/ exists)
[ ] Dependencies installed (pip install complete)
[ ] Configuration customized (config.json edited)
[ ] Service file installed (systemd OK)
[ ] Service enabled and running (systemctl status OK)

Deployment Verification:
[ ] Web dashboard accessible (http://[IP]:8080)
[ ] Default login works (admin/admin123)
[ ] Device shows "ONLINE" (green indicator)
[ ] Battery displays correctly (if enabled)
[ ] Storage metrics accurate
[ ] HTTPS accessible (https://[IP]:8080)
[ ] Domain accessible (https://me_cam.com)
[ ] Multi-device setup complete (if applicable)
[ ] Logs show no errors (journalctl clean)

Post-Deployment Maintenance:
[ ] Set up automated backups (if using cloud)
[ ] Configure motion detection sensitivity
[ ] Test email/SMS alerts (if configured)
[ ] Monitor disk space weekly (df -h)
[ ] Check logs monthly (journalctl)
[ ] Update system regularly (apt update/upgrade)
[ ] Backup config.json to secure location
[ ] Document any custom configurations

PART 10: COMMON COMMANDS REFERENCE
==================================

SERVICE MANAGEMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Start service:            sudo systemctl start mecamera
Stop service:             sudo systemctl stop mecamera
Restart service:          sudo systemctl restart mecamera
Check status:             sudo systemctl status mecamera
View logs (live):         sudo journalctl -u mecamera -f
View last 50 lines:       sudo journalctl -u mecamera -n 50
Enable auto-start:        sudo systemctl enable mecamera
Disable auto-start:       sudo systemctl disable mecamera

SYSTEM INFORMATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Get local IP:             hostname -I
Check hostname:           hostname
View active processes:    top (press 'q' to exit)
Check memory:             free -m
Check disk space:         df -h
Check uptime:             uptime
View OS info:             uname -a

PYTHON & ENVIRONMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Activate venv:            source ~/ME_CAM-DEV/venv/bin/activate
Deactivate venv:          deactivate
Check Python version:     python3 --version
List installed packages:  pip list
Update all packages:      pip install --upgrade -r requirements.txt
Test specific package:    python3 -c "import flask; print('OK')"

API TESTING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Test status:              curl http://127.0.0.1:8080/api/status
Check battery:            curl http://127.0.0.1:8080/api/battery
List devices:             curl http://127.0.0.1:8080/api/devices
Check storage:            curl http://127.0.0.1:8080/api/storage
Get recordings:           curl http://127.0.0.1:8080/api/recordings
Motion events:            curl http://127.0.0.1:8080/api/motion/events

FILE MANAGEMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
List files:               ls -la
Navigate directory:       cd [path]
Show current path:        pwd
Edit file:                nano [filename]
View file content:        cat [filename]
Search in files:          grep -r "text" .
Disk usage by folder:     du -sh [folder]/*

PART 11: VERSION & SUPPORT INFORMATION
======================================

Current Version: 2.1 (Production Ready)
Release Date: January 15, 2026
Python: 3.9+ required
OS: Raspberry Pi OS Bullseye (32-bit)

Recent Changes (v2.1):
âœ“ Fixed battery display (correct percentage calculation)
âœ“ Fixed dashboard auto-refresh (5-second updates)
âœ“ Fixed navbar consistency (all pages)
âœ“ Fixed multi-device API responses
âœ“ Added Pi model auto-detection
âœ“ Added TEST MODE for limited hardware
âœ“ Comprehensive error messages
âœ“ Improved HTTPS support

Support Resources:
â€¢ GitHub Issues: https://github.com/MangiafestoElectronicsLLC/ME_CAM-DEV/issues
â€¢ Documentation: See docs/ folder for detailed guides
â€¢ Troubleshooting: See PART 8 above for common issues
â€¢ Config Reference: See config/config_default.json for all options

====================================================
ME Camera System v2.1 - Setup Complete Reference
Last Updated: January 15, 2026
Ready for Production Deployment
====================================================