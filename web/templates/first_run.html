<!doctype html>
<html>

<head>
  <title>ME Camera - First Run Setup</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    .setup-container {
      max-width: 700px;
      margin: 40px auto;
    }

    .qr-section {
      background: #1a1a1a;
      border: 2px solid #2979ff;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      margin-bottom: 30px;
    }

    .qr-section h2 {
      color: #2979ff;
      margin-top: 0;
    }

    .qr-code {
      margin: 20px 0;
      padding: 20px;
      background: white;
      border-radius: 8px;
      display: inline-block;
    }

    .qr-code img {
      max-width: 300px;
      width: 100%;
    }

    .qr-info {
      color: #999;
      font-size: 14px;
      margin-top: 15px;
    }

    .setup-url {
      background: #0f0f0f;
      border: 1px solid #444;
      padding: 10px;
      border-radius: 6px;
      word-break: break-all;
      color: #64b5f6;
      font-family: monospace;
      margin: 15px 0;
    }

    .setup-section {
      margin: 30px 0;
      padding: 20px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 8px;
    }

    .setup-section h2 {
      margin-top: 0;
      color: #2979ff;
    }

    .form-group {
      margin: 15px 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #e0e0e0;
    }

    .form-group input[type="text"],
    .form-group input[type="password"],
    .form-group input[type="number"],
    .form-group input[type="email"] {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      background: #0f0f0f;
      border: 1px solid #444;
      color: #eee;
      border-radius: 4px;
    }

    .form-group input[type="checkbox"] {
      margin-right: 8px;
    }

    .btn {
      background: #2979ff;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .btn:hover {
      background: #1e5db8;
    }
  </style>
</head>

<body>
  <div class="navbar">
    <div class="brand">ðŸ“¹ ME Camera - Setup</div>
  </div>

  <div class="setup-container">
    <!-- QR Code Section -->
    <div class="qr-section">
      <h2>ðŸ“± Quick Setup</h2>
      <p>Scan this QR code or open the link below to configure your device</p>

      {% if qr_code %}
      <div class="qr-code">
        <img src="{{ qr_code }}" alt="Setup QR Code">
      </div>
      {% endif %}

      <div class="qr-info">
        <strong>Setup URL:</strong>
        <div class="setup-url">{{ setup_url }}</div>
        <p>Share this link with customers or scan the QR code on their device</p>
      </div>
    </div>

    <h1>ME Camera - First Time Setup</h1>

    <form method="post" action="/setup/save">

      <div class="setup-section">
        <h2>Device Configuration</h2>
        <div class="form-group">
          <label>Device Name:</label>
          <input type="text" name="device_name" value="{{ config.device_name }}" placeholder="e.g., Front Door">
        </div>
      </div>

      <div class="setup-section">
        <h2>Security</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" name="pin_enabled" {% if config.pin_enabled %}checked{% endif %}>
            Enable PIN Protection
          </label>
        </div>
        <div class="form-group">
          <label>PIN Code (4-6 digits):</label>
          <input type="password" name="pin_code" value="{{ config.pin_code }}" placeholder="1234">
        </div>
      </div>

      <div class="setup-section">
        <h2>Storage (Mandatory)</h2>
        <div class="form-group">
          <label>Retention Days:</label>
          <input type="number" name="retention_days" value="{{ config.storage.retention_days }}" min="1" max="365">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="motion_only" {% if config.storage.motion_only %}checked{% endif %}>
            Record only during motion (saves storage space)
          </label>
        </div>
        <br>
        <div class="form-group">
          <label>
            <input type="checkbox" name="encrypt" {% if config.storage.encrypt %}checked{% endif %}>
            Enable Encryption (store clips as .enc in '{{ config.storage.encrypted_dir }}')
          </label>
        </div>
      </div>

      <div class="setup-section">
        <h2>Detection Settings</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" name="person_only" {% if config.detection.person_only %}checked{% endif %}>
            Only trigger when a person is detected
          </label>
        </div>
        <div class="form-group">
          <label>Sensitivity (0.1-0.9, lower = more sensitive):</label>
          <input type="number" step="0.1" min="0.1" max="0.9" name="sensitivity"
            value="{{ config.detection.sensitivity }}">
        </div>
      </div>

      <div class="setup-section">
        <h2>Emergency Notifications (Optional)</h2>
        <div class="form-group">
          <label>Emergency Phone Number (e.g., +1-555-0123):</label>
          <input type="text" name="emergency_phone" value="{{ config.get('emergency_phone', '') }}"
            placeholder="+1-555-0123">
          <small style="color: #999;">For testing: use your phone. For deployment: use 911 or emergency
            dispatch.</small>
        </div>
      </div>

      <div class="setup-section">
        <h2>Email Notifications (Optional)</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" name="email_enabled" {% if config.email.enabled %}checked{% endif %}>
            Enable Email Alerts
          </label>
        </div>
        <div class="form-group">
          <label>Email Address to Receive Alerts:</label>
          <input type="email" name="email_address" value="{{ config.get('email_address', '') }}"
            placeholder="your@email.com">
        </div>
      </div>

      <div class="setup-section">
        <h2>Google Drive Backup (Optional)</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" name="gdrive_enabled" {% if config.google_drive.enabled %}checked{% endif %}>
            Enable Google Drive Backup
          </label>
        </div>
        <div class="form-group">
          <label>Google Drive Folder ID:</label>
          <input type="text" name="gdrive_folder_id" value="{{ config.google_drive.get('folder_id', '') }}"
            placeholder="Leave blank to skip">
          <small style="color: #999;">Get this from sharing a folder on Google Drive</small>
        </div>
      </div>

      <div class="setup-section">
        <h2>Network (Optional)</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" name="wifi_enabled" {% if config.get('wifi_enabled', True) %}checked{% endif %}>
            Enable WiFi
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="bluetooth_enabled" {% if config.get('bluetooth_enabled', False) %}checked{%
              endif %}>
            Enable Bluetooth (experimental)
          </label>
        </div>
      </div>

      <button type="submit" class="btn">Save & Continue to Dashboard</button>
    </form>
  </div>
</body>

</html>